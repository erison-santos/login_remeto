<html>
  <head>
    <title>Central de Apps</title>
    <style>
      @layer base, tokens, animations,  components, utilities;

      @layer tokens {
        @font-face {
          font-family: Troubleside;
          src: url("https://cdn.jsdelivr.net/gh/chytanka/chytanka.github.io/src/assets/fonts/Troubleside.ttf");
          font-display: swap;
        }

        :root {
          --ratio: 257 / 364;
          --t: 0.133333334s;
          --min-card-width: 192px;
          --accent: oklch(from #ffd60a l c h);
          --surface: oklch(from #166496 0.12 min(c, 0.0512) h);

          --avarage-l: 0.48;
          --avarage-l-2: 0.36;
          --avarage-base: oklch(from #ffd60a var(--avarage-l) 0.0192 h);
          --text: white;

          --radius: 0.5rem;
          --border-size: 0.25rem;

          background: var(--surface);
          color: var(--text);
          font-size: clamp(
            0.875rem,
            0.8214285714rem + 0.2380952381vw,
            1rem
          ) !important;
          line-height: 1.3;
          font-family: Arial, sans-serif;
        }

        @media (prefers-color-scheme: light) {
          :root {
            --avarage-l: 0.72;
            --avarage-l-2: 0.6;
            --accent: oklch(from #166496 l c h);
            --surface: oklch(from #ffd60a 1 min(c, 0.0256) h);
            --avarage-base: oklch(from #ffd60a 0.48 0.0192 h);
            --text: black;
          }
        }

        @property --item-scale {
          syntax: "<number>";
          inherits: true;
          initial-value: 1;
        }

        @property --item-angle {
          syntax: "<angle>";
          inherits: true;
          initial-value: 0deg;
        }
      }

      @layer animations {
        @keyframes shrink-top {
          0% {
            --item-scale: 0.5;
            --item-angle: -60deg;
            transform-origin: top;
          }
        }

        @keyframes shrink-bottom {
          0% {
            --item-scale: 0.5;
            --item-angle: 60deg;
            transform-origin: bottom;
          }
        }
      }

      @layer base {
        body,
        figure {
          margin: 0;
        }

        img {
          width: 100%;
          height: auto;
        }

        *,
        *::before,
        *::after {
          box-sizing: border-box;
        }

        a,
        a:visited {
          color: inherit;
          text-decoration: none;
        }
      }

      @layer components {
        .search-wrapper {
          display: flex;
          justify-content: center;
          align-items: center;
          flex-direction: column;
          margin-top: 3rem;
        }

        .searchBar {
          margin: 2rem;
          font-size: 1rem;
          width: 40%;
          padding: 0.5rem;
          border: 1px solid var(--border-size);
          border-radius: var(--radius);
          margin-bottom: 1rem;
          display: block;
        }

        h1 {
          color: var(--accent);
          font-family: Troubleside;
          margin: 1rem 0 0;
        }

        main {
          padding: 2rem;
        }

        section {
          margin-bottom: 2rem;
          position: relative;
          perspective: 4000px;
          display: grid;
          gap: 1.5rem;
          grid-template-columns: repeat(
            auto-fill,
            minmax(var(--min-card-width), 1fr)
          );

          & header {
            grid-column: 1 / -1;
          }
        }

        article {
          cursor: pointer;
          --deg: 0.8deg;
          --y: 0;
          --avarage: oklch(from var(--avarage-color) var(--avarage-l) 0.0192 h);
          --shadow-color: oklch(
            from var(--avarage, var(--avarage-base)) var(--avarage-l-2) c h
          );
          --shadow-distance: var(--border-size);
          border: var(--border-size) solid var(--avarage, var(--avarage-base));
          border-radius: var(--radius);
          background-color: var(--avarage, var(--avarage-base));
          background-image: radial-gradient(
            oklch(from var(--shadow-color) l c h) 1px,
            transparent 0px
          );
          background-repeat: repeat;
          background-size: 7px 7px;
          background-position: center;

          box-shadow: 1px 1px var(--surface),
            var(--shadow-distance) var(--shadow-distance) var(--shadow-color);
          opacity: min(var(--item-scale), 0.8);
          transform: rotate(var(--deg)) translateY(var(--y))
            scale(var(--item-scale)) rotateX(var(--item-angle));
          transition: all var(--t) ease-in-out;
          will-change: transform;
          transform-style: preserve-3d;

          &:hover {
            --deg: 0 !important;
            --y: -1.25ch;
            --shadow-distance: calc(var(--border-size) * 2);
            opacity: 1;
          }
        }

        @supports (animation-timeline: view()) {
          article {
            animation: shrink-top both ease-in-out,
              shrink-bottom both ease-in-out reverse;
            animation-timeline: view(block);
            animation-range: entry, exit;
          }
        }

        figure img {
          aspect-ratio: var(--ratio);
          object-fit: cover;
          border-radius: calc(var(--radius) - var(--border-size));
        }

        figure figcaption {
          font-family: Troubleside;
          margin: 1ch;
          display: -webkit-box;
          -webkit-box-orient: vertical;
          -webkit-line-clamp: 1;
          overflow: hidden;
          word-break: break-word;
          line-height: 1;
        }
      }

      @layer utilities {
        article:nth-child(2n) {
          --deg: -0.8deg;
        }

        article:nth-child(2n + 1) {
          --deg: -0.6deg;
        }

        article:nth-child(3n) {
          --deg: 0.6deg;
        }

        article:nth-child(4n + 2) {
          --deg: -0.75deg;
        }

        article:nth-child(5n) {
          --deg: 0.25deg;
        }

        article:nth-child(6n + 3) {
          --deg: -0.3deg;
        }

        article:nth-child(7n) {
          --deg: 0.9deg;
        }
      }
    </style>
  </head>

  <body>
    <div class="hexGallery" id="galeria-container"></div>

    <div class="search-wrapper">
      <input
        type="text"
        id="search-input"
        class="searchBar"
        placeholder="Pesquisar..."
      />
    </div>

    <div class="app-container" id="app-container"></div>

    <div
      id="no-results-message"
      style="
        display: none;
        text-align: center;
        margin-top: 2rem;
        font-style: italic;
        color: gray;
      "
    ></div>

    <script>
      let allApps = []

      // Função para renderizar os apps dinamicamente
      function renderApps(apps) {
        const container = document.getElementById("app-container")
        const noResultsMessage = document.getElementById("no-results-message")
        container.innerHTML = ""

        if (apps.length === 0) {
          fetch("../../assets/utils/ResultsFound/resultsfound.html")
            .then((res) => res.text())
            .then((html) => {
              noResultsMessage.innerHTML = html
              noResultsMessage.style.display = "block"
            })
            .catch((err) => {
              console.error("Erro ao carregar resultsfound.html:", err)
              noResultsMessage.innerHTML =
                "<p style='color:red;'>Erro ao exibir animação.</p>"
              noResultsMessage.style.display = "block"
            })
          return
        } else {
          noResultsMessage.innerHTML = ""
          noResultsMessage.style.display = "none"
        }

        const grouped = apps.reduce((acc, app) => {
          acc[app.category] = acc[app.category] || []
          acc[app.category].push(app)
          return acc
        }, {})

        Object.keys(grouped).forEach((category) => {
          const section = document.createElement("section")

          const header = document.createElement("header")
          header.innerHTML = `<h1>${category}</h1>`
          section.appendChild(header)

          grouped[category].forEach((app) => {
            const article = document.createElement("article")
            article.style.setProperty("--avarage-color", app.color)
            article.innerHTML = `
          <a class="downloadLink" href="${app.download}" download>
            <figure>
              <img src="${app.image}" alt="${app.name}" />
              <figcaption>${app.name}</figcaption>
            </figure>
          </a>
        `
            section.appendChild(article)
          })

          container.appendChild(section)
        })
      }

      // Carrega os apps e renderiza
      fetch("/data/apps.json")
        .then((res) => res.json())
        .then((apps) => {
          allApps = apps
          renderApps(allApps)
        })
        .catch((err) => {
          console.error("Erro ao carregar os aplicativos:", err)
        })

      // Filtra enquanto digita
      document.getElementById("search-input").addEventListener("input", (e) => {
        const query = e.target.value.toLowerCase()
        const filtered = allApps.filter((app) =>
          app.name.toLowerCase().includes(query)
        )
        renderApps(filtered)
      })
    </script>

    <script>
      async function carregarGaleria() {
        const container = document.getElementById("galeria-container")
        const response = await fetch(
          "../../assets/utils/GaleryHex/galeryHex.html"
        )
        const html = await response.text()
        container.innerHTML = html

        // Reexecuta qualquer script interno
        const scripts = container.querySelectorAll("script")
        scripts.forEach((oldScript) => {
          const newScript = document.createElement("script")
          newScript.text = oldScript.text
          document.body.appendChild(newScript)
          oldScript.remove()
        })
      }

      carregarGaleria()
    </script>
  </body>
</html>
